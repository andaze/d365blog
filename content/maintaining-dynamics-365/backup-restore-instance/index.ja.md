---
title:  "Dynamics 365 インスタンスのバックアップとリストア"
draft: false
weight: 2
datetitle: "2017.08.23 | "
showinhome: true
showinaccordian: false
rightMenu: "artical"
jsonld: {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": "Article headline",
      "image": [
        "https://example.com/photos/1x1/photo.jpg",
        "https://example.com/photos/4x3/photo.jpg",
        "https://example.com/photos/16x9/photo.jpg"
       ],
      "datePublished": "2015-02-05T08:00:00+08:00",
      "dateModified": "2015-02-05T09:20:00+08:00",
      "author": {
        "@type": "Person",
        "name": "John Doe"
       },
       "publisher": {
        "@type": "Organization",
        "name": "Google",
        "logo": {
          "@type": "ImageObject",
          "url": "https://google.com/logo.jpg"
         }
       }
    }
---
{{< detailTopImage src="artical2.jpg" >}}
{{< authorImage src="authorimage.jpg" name="Takafumi Noguchi" linkdin="https://www.linkedin.com/in/tnoguchi1123531" >}}
<!-- Intro  -->
Dynamics のインスタンスについてはこの記事が最後になります。この記事では、インスタンスのバックアップとリストアの方法をご紹介します。

## インスタンスのバックアップ
Dynamics 365 では、**インスタンス単位でのバックアップが自動で取得**されています。

取得頻度は1日1回、バックアップ保持期間は 3日分(最長) となっています。有効期限の切れたバックアップは自動的に削除されます。
<!-- Image= backup1.png -->
{{< imagedisplay src="backup1.png" >}}

### バックアップを手動で取得する（オンデマンド　バックアップ）
手動でバックアップを取得する場合は、「新しいバックアップ」　をクリックして、バックアップを取得します。

自動バックアップと同様、有効期間は3日間となっており、有効期限が切れると自動で削除される仕組みとなっています。

バックアップを取得するインスタンスを選択して、「新しいバックアップ」をクリックします。
<!-- Image= backup2.png -->
{{< imagedisplay src="backup2.png" >}}

ラベルにバックアップ名を入力して、「作成」をクリックするとバックアップ取得が行われます。
<!-- Image= backup3.png -->
{{< imagedisplay src="backup3.png" >}}

バックアップが作成されました。有効期限を確認して、3日以上保持するのであれば、再度バックアップを取得してください。
<!-- Image= backup4.png -->
{{< imagedisplay src="backup4.png" >}}

### バックアップの管理
作成したバックアップは、「編集」、「削除」、「復元」　を行うことができます。「編集」をクリックすると、バックアップ名を変更することができ、「削除」ではバックアップを削除することができます。

なお、「編集」、「削除」は、オンデマンド バックアップのみ有効です。システムで作成したバックアップは後述する「復元」しかできません。
<!-- Image= backup5.png -->
{{< imagedisplay src="backup5.png" >}}

## インスタンスの復元
インスタンスの復元は、取得したバックアップの「復元」で実施可能です。
<!-- Image= backup6.png -->
{{< imagedisplay src="backup6.png" >}}

復元元が現在のバックアップであり、「復元先の選択」でバックアップを復元する先のインスタンスを選択します。なお、復元先として選択できるインスタンスは　**サンドボックス**　のみです。

「次へ」をクリックして、確認画面にて、「復元」ボタンをクリックすると復元が開始されます。

<!-- Image= backup7.png -->
{{< imagedisplay src="backup7.png" >}}

では、**実稼働のインスタンス　をバックアップから復元する**場合はどうすればいいのでしょうか。

### 実稼働インスタンスをバックアップから復元させる
実稼働インスタンスをバックアップから復元させるには、下記の方法を実施するといいでしょう。この方法は実稼働とサンドボックスの、最低でもインスタンスの２つが必要になります。

※復元作業を実施する場合は、ユーザーに影響がない時間を選択して、慎重に行う必要があります。

  * **実稼働インスタンスとサンドボックス インスタンスをオンデマンド バックアップする**   
    まず、インスタンスのバックアップを実稼働とサンドボックスの両方で取得しておきます。取得方法は バックアップを手動で取得する（オンデマンド　バックアップ） 上述した　のとおりです。
  * **サンボボックス　インスタンスに、上記1. で取得した実稼働インスタンスのバックアップを復元する**   
    実稼働インスタンスのバックアップを、まずサンドボックス インスタンスに復元します。もし実稼働の復元が正常完了しなかった場合は、修復まではサンドボックス インスタンスを利用することになります。
  <!-- Image= backup8.png -->
{{< imagedisplay src="backup8.png" >}}

  Consulting (実稼働)を復元元インスタンス、Dynamics Consulting (サンドボックス) 復元先インスタンスとしてバックアップを復元します。
  <!-- Image= backup9.png -->
{{< imagedisplay src="backup9.png" >}}

  * **上記2. が問題なく復元できた場合、実稼働インスタンスを　サンドボックスインスタンスに切り替える**   
    実稼働インスタンスの「編集」から、インスタンスの種類を「実稼働」から「サンドボックス」に切り替えます。
  <!-- Image= backup10.png -->
{{< imagedisplay src="backup10.png" >}}

  インスタンスの種類を　「サンドボックス」　に切り替えます。「次へ」をクリックして、確認画面にて、「保存」ボタンをクリックします。
  <!-- Image= backup11.png -->
{{< imagedisplay src="backup11.png" >}}

  これで、実稼働だったインスタンスが、サンドボックス インスタンスに切り替わりました。
  <!-- Image= backup12.png -->
{{< imagedisplay src="backup12.png" >}}

* **上記3.でサンドボックス　インスタンスに切り替えたインスタンスを、上記1.で取得した実稼働インスタンスのバックアップで復元する**
  
  これで、実稼働だったインスタンスの復元を行います。利用するバックアップは、1で取得したバックアップ（下記の例でいうと、Consulting のバックアップ）になります。ここでは、復元元、復元先の両方が Consulting インスタンスに選択されています。

  「次へ」をクリックして、確認画面にて、「復元」ボタンをクリックすると復元が開始されます。
  <!-- Image= backup13.png -->
{{< imagedisplay src="backup13.png" >}}

  * **復元が正常完了したら、実稼働インスタンスに戻す**  
   上記　 でサンドボックスに切り替えたインスタンスを、再度実稼働に戻します。これが完了したら復元は終わりです。上記1.で作成したバックアップが不要であれば削除をします。

### もし復元中に失敗したら？
もしインスタンス復元が失敗した場合は、そのインスタンスをリセットして、その後バックアップから復元する必要があります。なお、リセットできるインスタンスはサンドボックス インスタンスのみです。   
また、この方法で確実に修復できるわけではないので注意が必要です。
<!-- Image= backup14.png -->
{{< imagedisplay src="backup14.png" >}}

インスタンスの復元が失敗して、上記の「リセット」ボタンが表示されない場合は、しばらく時間を置いて表示されるのを待ってみてください。それでも表示されない場合は、マイクロソフトにお問い合わせをして状況を確認する必要があります。

このようにインスタンスの復元は失敗することもあり、復元に時間がかかることが想定されます。リスクがあるため、なるべく実稼働のインスタンスについては復元を避ける、もしくはサンドボックス インスタンスと切り替えてユーザーに利用させるような運用を事前に考えておく必要はあると思います。

インスタンスのバックアップと復元は下記の技術情報もご参考ください。

**インスタンスのバックアップと復元**

[https://docs.microsoft.com/ja-jp/dynamics365/customer-engagement/admin/backup-restore-instances](https://docs.microsoft.com/ja-jp/dynamics365/customer-engagement/admin/backup-restore-instances)

以上で Dynamics 365 のインスタンスについては終了です。